var d=Object.defineProperty;var l=(n,e,r)=>e in n?d(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var o=(n,e,r)=>(l(n,typeof e!="symbol"?e+"":e,r),r);class h{constructor(){o(this,"credentials",[{id:1,name:"Gmail",url:"gmail.com",username:"john.doe@gmail.com",password:"MySecure2023!"},{id:2,name:"GitHub",url:"github.com",username:"johndoe_dev",password:"CodeMaster#456"},{id:3,name:"Amazon",url:"amazon.com",username:"john.doe@email.com",password:"Shop2023$ecure"},{id:4,name:"Work Portal",url:"company.com",username:"j.doe",password:"Work@Pass789"},{id:5,name:"LinkedIn",url:"linkedin.com",username:"john-doe-professional",password:"Network#2023"}]);this.setupMessageHandlers(),this.loadCredentials()}setupMessageHandlers(){chrome.runtime.onMessage.addListener((e,r,t)=>(this.handleMessage(e,r,t),!0)),chrome.runtime.onInstalled.addListener(()=>{console.log("Grand Warden extension installed"),this.saveCredentials()}),chrome.tabs.onUpdated.addListener((e,r,t)=>{r.status==="complete"&&t.url&&this.checkForLoginPage(e,t.url)})}async handleMessage(e,r,t){switch(e.type){case"GET_CREDENTIALS_FOR_DOMAIN":const a=this.getCredentialsForDomain(e.domain);t({success:!0,credentials:a,domain:e.domain});break;case"SAVE_CREDENTIAL":const s=await this.saveNewCredential(e.credential);t({success:s,id:s?Date.now():null});break;case"GET_ALL_CREDENTIALS":t({success:!0,credentials:this.credentials});break;case"DELETE_CREDENTIAL":const i=this.deleteCredential(e.id);t({success:i});break;case"UPDATE_CREDENTIAL":const c=this.updateCredential(e.id,e.credential);t({success:c});break;case"OPEN_SAVE_DIALOG":this.openPopupWithContext(e.domain,e.url),t({success:!0});break;case"PING":t({status:"alive",timestamp:Date.now()});break;default:t({success:!1,error:"Unknown message type"})}}getCredentialsForDomain(e){return this.credentials.filter(r=>{const t=r.url.replace(/^https?:\/\//,"").replace(/^www\./,""),a=e.replace(/^www\./,"");return t===a||t.includes(a)||a.includes(t.replace(".com",""))})}async saveNewCredential(e){try{const r={...e,id:Date.now()+Math.random()};return this.credentials.push(r),await this.saveCredentials(),this.notifyContentScripts("CREDENTIAL_ADDED",r),!0}catch(r){return console.error("Failed to save credential:",r),!1}}deleteCredential(e){const r=this.credentials.findIndex(t=>t.id===e);return r!==-1?(this.credentials.splice(r,1),this.saveCredentials(),!0):!1}updateCredential(e,r){const t=this.credentials.find(a=>a.id===e);return t?(Object.assign(t,r),this.saveCredentials(),!0):!1}async loadCredentials(){try{const e=await chrome.storage.local.get(["grandWardenCredentials"]);e.grandWardenCredentials&&(this.credentials=e.grandWardenCredentials,console.log(`Loaded ${this.credentials.length} saved credentials`))}catch{console.log("Using default credentials (storage not available)")}}async saveCredentials(){try{await chrome.storage.local.set({grandWardenCredentials:this.credentials}),console.log(`Saved ${this.credentials.length} credentials to storage`)}catch(e){console.error("Failed to save credentials to storage:",e)}}async checkForLoginPage(e,r){try{const t=new URL(r).hostname,a=this.getCredentialsForDomain(t);a.length>0?(chrome.action.setBadgeText({tabId:e,text:a.length.toString()}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#3b82f6"}),chrome.action.setTitle({tabId:e,title:`Grand Warden - ${a.length} saved credential${a.length>1?"s":""} for ${t}`})):(chrome.action.setBadgeText({tabId:e,text:""}),chrome.action.setTitle({tabId:e,title:"Grand Warden - Secure Password Manager"}))}catch(t){console.error("Error checking login page:",t)}}async notifyContentScripts(e,r){try{(await chrome.tabs.query({active:!0})).forEach(a=>{a.id&&chrome.tabs.sendMessage(a.id,{type:e,data:r}).catch(()=>{})})}catch(t){console.error("Error notifying content scripts:",t)}}async openPopupWithContext(e,r){try{await chrome.storage.local.set({popupContext:{domain:e,url:r,timestamp:Date.now()}}),console.log(`Context set for popup: ${e}`)}catch(t){console.error("Error setting popup context:",t)}}}new h;chrome.runtime.onSuspend.addListener(()=>{console.log("Grand Warden background service worker suspending")});
